---
#: Prepare and transfer ionic front-end JS app

- name: create webroot and static dirs
  file:
    path: /opt/poolctl/webroot/static
    state: directory
    recurse: yes

- name: ensure webapp is built
  delegate_to: localhost
  run_once: yes
  command: ionic build --engine=browser --prod
  args:
    chdir: ../../../ionic-fe
    creates: www/index.html

- name: sync local www directory to remote
  synchronize:
    src: ../../../ionic-fe/www
    dest: /opt/poolctl/webroot/
    checksum: yes  # compare based on checksums rather than timestamps
    rsync_opts:
      - '--delete'
      - '--ignore-errors'
      - '--force'
  notify: restart poolctl service
